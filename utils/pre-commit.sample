#!/bin/bash

# â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
# â”‚ ğŸ§  Git Pre-commit Hook: Auto-Organize LeetCode Solutions     â”‚
# â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
# This hook automatically organizes LeetCode problem files before each commit.
# 
# âœ… What it does:
# - Scans newly added files staged for commit (via `git add`).
# - Matches files like: questions/1838.frequency-of-the-most-frequent-element.go
# - For each match:
#     - Creates a folder: questions/1838.frequency-of-the-most-frequent-element/
#     - Moves the file into that folder as: solution.<ext> (e.g., solution.go)
#     - Updates Git staging to reflect the new path.
# 
# ğŸ¯ Purpose:
# Keeps your `questions/` folder clean and structured â€” one folder per problem,
# no matter how many languages you've solved it in.
#
# ğŸ“ Example:
# Before:
#   questions/
#     1838.frequency-of-the-most-frequent-element.go
#     1838.frequency-of-the-most-frequent-element.java
#
# After commit:
#   questions/
#     1838.frequency-of-the-most-frequent-element/
#       solution.go
#       solution.java

echo "ğŸ” Checking for LeetCode files in questions/ to organize..."

# All newly added files
files_to_add=$(git diff --cached --name-only --diff-filter=A)

organized_any=false

for file in $files_to_add; do
    # Match only files directly under questions/, e.g. questions/1234.two-sum.go
    if [[ $file =~ ^questions/([0-9]+\.[a-z0-9-]+)\.(go|js|py|java|cpp|c)$ ]]; then
        base="${BASH_REMATCH[1]}"      # e.g. "1838.frequency-of-the-most-frequent-element"
        ext="${BASH_REMATCH[2]}"       # e.g. "go" or "java"
        folder="questions/$base"       # e.g. "questions/1838.frequency-of-the-most-frequent-element"
        
        echo "ğŸ“ Organizing: $file â†’ $folder/solution.$ext"
        
        # Create folder if it doesn't exist (no-op if it does)
        mkdir -p "$folder"
        
        # Move & rename into place
        mv "$file" "$folder/solution.$ext"
        
        # Update Git staging: unstage old, stage new
        git reset HEAD "$file" 2>/dev/null
        git add "$folder/solution.$ext"
        
        organized_any=true
    fi
done

if [ "$organized_any" = true ]; then
    echo "âœ… Files organized! Proceeding with commit..."
else
    echo "â„¹ï¸  No LeetCode files to organize."
fi

exit 0